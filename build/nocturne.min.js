(function(_1){
var _2={VERSION:"0.0.7",lesson:"Part 7: Events"};
_2.isArray=Array.isArray||function(_3){
return !!(_3&&_3.concat&&_3.unshift&&!_3.callee);
};
_2.isNumber=function(_4){
return (_4===+_4)||(toString.call(_4)==="[object Number]");
};
_2.bind=function(fn,_5){
var _6=Array.prototype.slice,_7=_6.apply(arguments,[2]);
return function(){
return fn.apply(_5||{},_7.concat(_6.apply(arguments)));
};
};
if(_1.nocturne){
throw new Error("nocturne has already been defined");
}else{
_1.nocturne=_2;
}
})(typeof window==="undefined"?this:window);
nocturne.Class=function(){
return nocturne.oo.create.apply(this,arguments);
};
nocturne.oo={create:function(){
var _8=null,_9=undefined,_a=function(){
this.$super=function(_b,_c){
return nocturne.oo.$super(this.$parent,this,_b,_c);
};
this.initialize.apply(this,arguments);
};
if(typeof arguments[0]==="function"){
_9=arguments[0];
_8=arguments[1];
}else{
_8=arguments[0];
}
if(typeof _9!=="undefined"){
nocturne.oo.extend(_a.prototype,_9.prototype);
_a.prototype.$parent=_9.prototype;
}
nocturne.oo.mixin(_a,_8);
nocturne.oo.extend(_a.prototype,_8);
_a.prototype.constructor=_a;
if(!_a.prototype.initialize){
_a.prototype.initialize=function(){
};
}
return _a;
},mixin:function(_d,_e){
if(typeof _e.include!=="undefined"){
if(typeof _e.include==="function"){
nocturne.oo.extend(_d.prototype,_e.include.prototype);
}else{
for(var i=0;i<_e.include.length;i++){
nocturne.oo.extend(_d.prototype,_e.include[i].prototype);
}
}
}
},extend:function(_f,_10){
for(var _11 in _10){
_f[_11]=_10[_11];
}
return _f;
},$super:function(_12,_13,_14,_15){
return _12[_14].apply(_13,_15);
}};
nocturne.enumerable={Break:{},each:function(_16,_17,_18){
try{
if(Array.prototype.forEach&&_16.forEach===Array.prototype.forEach){
_16.forEach(_17,_18);
}else{
if(nocturne.isNumber(_16.length)){
for(var i=0,l=_16.length;i<l;i++){
_17.call(_16,_16[i],i,_16);
}
}else{
for(var key in _16){
if(hasOwnProperty.call(_16,key)){
_17.call(_16,_16[key],key,_16);
}
}
}
}
}
catch(e){
if(e!=nocturne.enumerable.Break){
throw e;
}
}
return _16;
},map:function(_19,_1a,_1b){
if(Array.prototype.map&&_19.map===Array.prototype.map){
return _19.map(_1a,_1b);
}
var _1c=[];
nocturne.enumerable.each(_19,function(_1d,_1e,_1f){
_1c.push(_1a.call(_1b,_1d,_1e,_1f));
});
return _1c;
},filter:function(_20,_21,_22){
if(Array.prototype.filter&&_20.filter===Array.prototype.filter){
return _20.filter(_21,_22);
}
var _23=[],_24=!nocturne.isArray(_20);
nocturne.enumerable.each(_20,function(_25,_26,_27){
if(_21.call(_22,_25,_26,_27)){
if(_24){
_23.push([_26,_25]);
}else{
_23.push(_25);
}
}
});
return _23;
},reject:function(_28,_29,_2a){
return this.filter(_28,function(){
return !_29.apply(_2a,arguments);
},_2a);
},reduce:function(_2b,_2c,_2d,_2e){
if(Array.prototype.reduce&&_2b.reduce===Array.prototype.reduce){
return _2b.reduce(nocturne.bind(_2d,_2e),_2c);
}
nocturne.enumerable.each(_2b,function(_2f,_30,_31){
_2c=_2d.call(_2e,_2c,_2f,_30,_31);
});
return _2c;
},flatten:function(_32){
return nocturne.enumerable.reduce(_32,[],function(_33,_34){
if(nocturne.isArray(_34)){
return _33.concat(nocturne.enumerable.flatten(_34));
}
_33.push(_34);
return _33;
});
},tail:function(_35,_36){
_36=typeof _36==="undefined"?1:_36;
return Array.prototype.slice.apply(_35,[_36]);
},invoke:function(_37,_38){
var _39=nocturne.enumerable.tail(arguments,2);
return nocturne.enumerable.map(_37,function(_3a){
return (_38?_3a[_38]:_3a).apply(_3a,_39);
});
},pluck:function(_3b,key){
return nocturne.enumerable.map(_3b,function(_3c){
return _3c[key];
});
},some:function(_3d,_3e,_3f){
_3e=_3e||nocturne.enumerable.identity;
if(Array.prototype.some&&_3d.some===Array.prototype.some){
return _3d.some(_3e,_3f);
}
var _40=false;
nocturne.enumerable.each(_3d,function(_41,_42,_43){
if(_40=_3e.call(_3f,_41,_42,_43)){
throw nocturne.enumerable.Break;
}
});
return _40;
},detect:function(_44,_45,_46){
var _47;
nocturne.enumerable.each(_44,function(_48,_49,_4a){
if(_45.call(_46,_48,_49,_4a)){
_47=_48;
throw nocturne.enumerable.Break;
}
});
return _47;
},chain:function(_4b){
return new nocturne.enumerable.Chainer(_4b);
},identity:function(_4c){
return _4c;
},all:function(_4d,_4e,_4f){
_4e=_4e||nocturne.enumerable.identity;
if(Array.prototype.every&&_4d.every===Array.prototype.every){
return _4d.every(_4e,_4f);
}
var _50=true;
nocturne.enumerable.each(_4d,function(_51,_52,_53){
if(!(_50=_50&&_4e.call(_4f,_51,_52,_53))){
throw nocturne.enumerable.Break;
}
});
return _50;
},include:function(_54,_55){
if(Array.prototype.indexOf&&_54.indexOf===Array.prototype.indexOf){
return _54.indexOf(_55)!=-1;
}
var _56=false;
nocturne.enumerable.each(_54,function(_57,key){
if(_56=_57===_55){
throw nocturne.enumerable.Break;
}
});
return _56;
},};
nocturne.enumerable.select=nocturne.enumerable.filter;
nocturne.enumerable.inject=nocturne.enumerable.reduce;
nocturne.enumerable.collect=nocturne.enumerable.map;
nocturne.enumerable.rest=nocturne.enumerable.tail;
nocturne.enumerable.any=nocturne.enumerable.some;
nocturne.enumerable.every=nocturne.enumerable.all;
nocturne.chainableMethods=["map","collect","detect","filter","reduce","tail","rest","reject","pluck","any","some"];
nocturne.enumerable.Chainer=nocturne.Class({initialize:function(_58){
this.results=_58;
},values:function(){
return this.results;
}});
nocturne.enumerable.each(nocturne.chainableMethods,function(_59){
var _5a=nocturne.enumerable[_59];
nocturne.enumerable.Chainer.prototype[_59]=function(){
var _5b=Array.prototype.slice.call(arguments);
_5b.unshift(this.results);
this.results=_5a.apply(this,_5b);
return this;
};
});
nocturne.functional={curry:nocturne.bind,memorize:function(_5c,fn){
var _5d=function(n){
var _5e=_5c[n];
if(typeof _5e!=="number"){
_5e=fn(_5d,n);
_5c[n]=_5e;
}
return _5e;
};
return _5d;
}};
(function(){
var dom={},_5f=Error,_60,_61,_62,_63,_64,_65,_66,_67;
_60={"nl":"\n|\r\n|\r|\f","w":"[s\r\n\f]*","nonascii":"[^\x00-]","num":"-?([0-9]+|[0-9]*.[0-9]+)","unicode":"\\[0-9A-Fa-f]{1,6}(\r\n|[s\n\r\t\f])?","escape":"#{unicode}|\\[^\n\r\f0-9A-Fa-f]","nmchar":"[_A-Za-z0-9-]|#{nonascii}|#{escape}","nmstart":"[_A-Za-z]|#{nonascii}|#{escape}","ident":"[-@]?(#{nmstart})(#{nmchar})*","name":"(#{nmchar})+","string1":"\"([^\n\r\f\"]|#{nl}|#{nonascii}|#{escape})*\"","string2":"'([^\n\r\f']|#{nl}|#{nonascii}|#{escape})*'","string":"#{string1}|#{string2}"};
_61={"name and id":"(#{ident}##{ident})","id":"(##{ident})","class":"(\\.#{ident})","name and class":"(#{ident}\\.#{ident})","element":"(#{ident})","pseudo class":"(:#{ident})"};
function _68(){
function _69(_6a,_6b){
var _6c=true,_6d;
while(_6c){
_6d=_6a.match(/#\{([^}]+)\}/);
if(_6d&&_6d[1]){
_6a=_6a.replace(new RegExp("#{"+_6d[1]+"}","g"),_6b[_6d[1]]);
_6c=true;
}else{
_6c=false;
}
}
return _6a;
};
function _6e(_6f){
return _6f.replace(/\//g,"//");
};
function _70(){
var key,_71,_72={},_73,_74;
if(arguments.length===2){
_74=arguments[0];
_73=arguments[1];
}else{
_74=arguments[0];
_73=arguments[0];
}
for(key in _73){
_71=_6e(_69(_73[key],_74));
_72[key]=_71;
}
return _72;
};
function _75(_76){
var _77=[],key;
for(key in _76){
_77.push(_76[key]);
}
return new RegExp(_77.join("|"),"g");
};
return _75(_70(_70(_60),_61));
};
_67=_68();
_63={byId:function(_78,id){
return [_78.getElementById(id)];
},byNodeName:function(_79,_7a){
var i,_7b=[],_7c=_79.getElementsByTagName(_7a);
for(i=0;i<_7c.length;i++){
_7b.push(_7c[i]);
}
return _7b;
},byClassName:function(_7d,_7e){
var i,_7f=[],_80=_7d.getElementsByTagName("*");
for(i=0;i<_80.length;i++){
if(_80[i].className.match("\\b"+_7e+"\\b")){
_7f.push(_80[i]);
}
}
return _7f;
}};
_65={"id":function(_81,_82){
_82=_82.split("#")[1];
return _63.byId(_81,_82);
},"name and id":function(_83,_84){
var _85=_84.split("#"),_86,id;
_86=_85[0];
id=_85[1];
return _66.byAttr(_63.byId(_83,id),"nodeName",_86.toUpperCase());
},"name":function(_87,_88){
return _63.byNodeName(_87,_88);
},"class":function(_89,_8a){
_8a=_8a.split(".")[1];
return _63.byClassName(_89,_8a);
},"name and class":function(_8b,_8c){
var _8d=_8c.split("."),_8e,_8f;
_8e=_8d[0];
_8f=_8d[1];
return _66.byAttr(_63.byClassName(_8b,_8f),"nodeName",_8e.toUpperCase());
}};
if(typeof document.getElementsByClassName!=="undefined"){
_63.byClassName=function(_90,_91){
return _90.getElementsByClassName(_91);
};
}
_66={byAttr:function(_92,_93,_94){
var key,_95=[];
for(key in _92){
if(_92[key]&&_92[key][_93]===_94){
_95.push(_92[key]);
}
}
return _95;
}};
_64={"id":function(_96,_97){
_97=_97.split("#")[1];
return _96&&_96.id===_97;
},"name":function(_98,_99){
return _98.nodeName===_99.toUpperCase();
},"name and id":function(_9a,_9b){
return _64.id(_9a,_9b)&&_64.name(_9a,_9b.split("#")[0]);
},"class":function(_9c,_9d){
if(_9c&&_9c.className){
_9d=_9d.split(".")[1];
return _9c.className.match("\\b"+_9d+"\\b");
}
},"name and class":function(_9e,_9f){
return _64["class"](_9e,_9f)&&_64.name(_9e,_9f.split(".")[0]);
}};
function _a0(_a1,_a2){
this.root=_a1;
this.key_selector=_a2.pop();
this.tokens=_a2;
this.results=[];
};
_a0.prototype.matchesToken=function(_a3,_a4){
if(!_64[_a4.finder]){
throw new _5f("Invalid matcher: "+_a4.finder);
}
return _64[_a4.finder](_a3,_a4.identity);
};
_a0.prototype.find=function(_a5){
if(!_65[_a5.finder]){
throw new _5f("Invalid finder: "+_a5.finder);
}
return _65[_a5.finder](this.root,_a5.identity);
};
_a0.prototype.matchesAllRules=function(_a6){
var _a7=this.tokens.slice(),_a8=_a7.pop(),_a9=_a6.parentNode,_aa=false;
if(!_a8||!_a9){
return false;
}
while(_a9&&_a8){
if(this.matchesToken(_a9,_a8)){
_aa=true;
_a8=_a7.pop();
}
_a9=_a9.parentNode;
}
return _aa&&_a7.length===0;
};
_a0.prototype.parse=function(){
var i,_ab,_ac=this.find(this.key_selector),_ad=[];
for(i=0;i<_ac.length;i++){
_ab=_ac[i];
if(this.tokens.length>0){
if(this.matchesAllRules(_ab)){
_ad.push(_ab);
}
}else{
if(this.matchesToken(_ab,this.key_selector)){
_ad.push(_ab);
}
}
}
return _ad;
};
_a0.prototype.values=function(){
return this.results;
};
function _ae(_af){
return _af.replace(/^\s+|\s+$/g,"").replace(/[ \t\r\n\f]+/g," ");
};
function _b0(_b1,_b2){
this.identity=_b1;
this.finder=_b2;
};
_b0.prototype.toString=function(){
return "identity: "+this.identity+", finder: "+this.finder;
};
function _b3(_b4){
this.selector=_ae(_b4);
this.tokens=[];
this.tokenize();
};
_b3.prototype.tokenize=function(){
var _b5,r,_b6;
r=_67;
r.lastIndex=0;
while(_b5=r.exec(this.selector)){
_b6=null;
if(_b5[10]){
_b6="id";
}else{
if(_b5[1]){
_b6="name and id";
}else{
if(_b5[29]){
_b6="name";
}else{
if(_b5[15]){
_b6="class";
}else{
if(_b5[20]){
_b6="name and class";
}
}
}
}
}
this.tokens.push(new _b0(_b5[0],_b6));
}
return this.tokens;
};
_b3.prototype.finders=function(){
var i,_b7=[];
for(i in this.tokens){
_b7.push(this.tokens[i].finder);
}
return _b7;
};
dom.tokenize=function(_b8){
var _b9=new _b3(_b8);
return _b9;
};
dom.get=function(_ba){
var _bb=dom.tokenize(_ba).tokens,_bc=new _a0(document,_bb);
return _bc.parse();
};
nocturne.dom=dom;
})();
(function(){
var _bd={},_be=[];
function _bf(_c0){
return _c0.nodeType!==3&&_c0.nodeType!==8;
};
function _c1(_c2){
_c2.preventDefault(_c2);
_c2.stopPropagation(_c2);
};
function fix(_c3,_c4){
if(!_c3){
var _c3=window.event;
}
_c3.stop=function(){
_c1(_c3);
};
if(typeof _c3.target==="undefined"){
_c3.target=_c3.srcElement||_c4;
}
if(!_c3.preventDefault){
_c3.preventDefault=function(){
_c3.returnValue=false;
};
}
if(!_c3.stopPropagation){
_c3.stopPropagation=function(){
_c3.cancelBubble=true;
};
}
if(_c3.target&&_c3.target.nodeType===3){
_c3.target=_c3.target.parentNode;
}
if(_c3.pageX==null&&_c3.clientX!=null){
var doc=document.documentElement,_c5=document.body;
_c3.pageX=_c3.clientX+(doc&&doc.scrollLeft||_c5&&_c5.scrollLeft||0)-(doc&&doc.clientLeft||_c5&&_c5.clientLeft||0);
_c3.pageY=_c3.clientY+(doc&&doc.scrollTop||_c5&&_c5.scrollTop||0)-(doc&&doc.clientTop||_c5&&_c5.clientTop||0);
}
return _c3;
};
function _c6(_c7,_c8){
return function(_c9){
fix(_c9,_c7);
return _c8(_c9);
};
};
function _ca(_cb,_cc,_cd){
var i=0,_ce,j=0;
for(j=0;j<_be.length;j++){
if(_be[j].element!==_cb&&_be[j].type!==_cc&&_be[j].handler!==_cd){
_be[i++]=_be[j];
}else{
_ce=_be[j].responder;
}
}
_be.length=i;
return _ce;
};
_bd.add=function(_cf,_d0,_d1){
if(!_bf(_cf)){
return;
}
var _d2=_c6(_cf,_d1);
_be.push({element:_cf,type:_d0,handler:_d1,responder:_d2});
if(_cf.addEventListener){
_cf.addEventListener(_d0,_d2,false);
}else{
if(_cf.attachEvent){
_cf.attachEvent("on"+_d0,_d2);
}
}
};
_bd.remove=function(_d3,_d4,_d5){
if(!_bf(_d3)){
return;
}
var _d6=_ca(_d3,_d4,_d5);
if(document.removeEventListener){
_d3.removeEventListener(_d4,_d6,false);
}else{
_d3.detachEvent("on"+_d4,_d6);
}
};
_bd.fire=function(_d7,_d8){
var _d9;
if(document.createEventObject){
_d9=document.createEventObject();
fix(_d9,_d7);
return _d7.fireEvent("on"+_d8,_d9);
}else{
_d9=document.createEvent("HTMLEvents");
fix(_d9,_d7);
_d9.initEvent(_d8,true,true);
return !_d7.dispatchEvent(_d9);
}
};
nocturne.events=_bd;
if(typeof window!=="undefined"&&window.attachEvent&&!window.addEventListener){
window.attachEvent("onunload",function(){
for(var i=0;i<_be.length;i++){
try{
_bd.remove(_be[i].element,_be[i].type);
_be[i]=null;
}
catch(e){
}
}
});
}
})();
nocturne.aliasFramework=function(){
var _da=function(){
if(typeof arguments[0]==="string"&&nocturne.dom){
return nocturne.dom.get(arguments[0]);
}else{
return nocturne;
}
};
if(nocturne.enumerable){
nocturne.enumerable.each(nocturne.enumerable,function(fn,_db){
_da[_db]=fn;
});
}
if(nocturne.dom){
_da.dom=nocturne.dom;
}
if(nocturne.events){
_da.events=nocturne.events;
}
return _da;
};
$n=nocturne.aliasFramework();

